(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/poiuy-uImgUpload/imgUpload"],{"112f":function(t,r,e){"use strict";var n;e.d(r,"b",(function(){return i})),e.d(r,"c",(function(){return o})),e.d(r,"a",(function(){return n}));var i=function(){var t=this,r=t.$createElement;t._self._c},o=[]},"6c20":function(t,r,e){},"7b65":function(t,r,e){"use strict";(function(t){function e(t){return o(t)||i(t)||s(t)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function o(t){if(Array.isArray(t))return u(t)}function a(t,r){var e;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=s(t))||r&&t&&"number"===typeof t.length){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(u)throw o}}}}function s(t,r){if(t){if("string"===typeof t)return u(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,r):void 0}}function u(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c={name:"imgUpload",props:{imgArr:{type:[Array]},uploadImgCount:{type:String,default:"3"},imgCount:{type:String,default:"3"},imgSize:{type:Number,default:2},formData:{type:Object,default:function(){return{}}},imgType:{type:[Array],default:function(){return["jpeg","png","jpg"]}},closeTip:{type:Boolean,default:!1},loading:{type:Boolean,default:!0},url:{type:String},async:{type:Boolean,default:!1},header:{type:Array,default:function(){return[]}},previewMany:{type:Boolean,default:!1},pressImg:{type:Number,default:-1},config:{type:Object,default:function(){return{}}}},data:function(){return{sysInfo:{},imgArray:[],canUpCount:"",startUpload:!1,tipObj:{prompt:"",typeColor:"#009100",must:!1,success:"#009100",warning:"#bb9300",error:"#FF0000"},conf:{delIcon:"",resultTip:!0,style:"1",loadIcon:"",loadText:"",borderStyle:"border:2px dotted #dadada",addStyle:"2"},headers:{},curPlatform:"",currIndex:null}},created:function(){this.getSysInfo(),this.imgArray=this.imgArr||[],this.changeImgArr(!0),this.canUpCount=Number(this.uploadImgCount),this.url?this.tipObj.prompt="":(this.tipObj.prompt="你没有传入上传url,请检查传入参数",this.tipObj.typeColor=this.tipObj.error),this.changeHeader(this.header),this.conf=Object.assign(this.conf,this.config)},watch:{imgArr:function(t,r){this.imgArray=t||[],this.changeImgArr(!0)},imgCount:function(t,r){this.uploadImgCount=t,this.canUpCount=Number(this.uploadImgCount)},url:function(t,r){t?this.tipObj.prompt="":(this.tipObj.prompt="你没有传入上传url,请检查传入参数",this.tipObj.typeColor=this.tipObj.error)},header:function(t,r){this.changeHeader(t)},config:function(t,r){this.conf=Object.assign(this.conf,this.config)}},methods:{upPhoto:function(){var r=this;if(!r.url)return r.tipObj.prompt="你没有传入上传url,请检查！",void(r.tipObj.typeColor=r.tipObj.error);Number(r.imgCount-r.imgArray.length)<Number(r.uploadImgCount)&&(r.canUpCount=Number(r.imgCount-r.imgArray.length)),r.tipObj.must||(r.tipObj.prompt=""),r.tipObj.must=!1,t.showActionSheet({itemList:["拍照上传","从相册中选择"],success:function(n){0==n.tapIndex?t.chooseImage({count:Number(r.canUpCount),sizeType:["original","compressed"],sourceType:["camera"],success:function(n){if(n){if(n.tempFiles){var i,o=a(n.tempFiles);try{var s=function(){var e=i.value;if(e.size>1024*r.imgSize*1024)return t.showToast({title:"图片不能大于".concat(r.imgSize,"M"),icon:"none"}),{v:!1};if(e.type){var n=r.imgType.some((function(t){var r=e.type.split("/");if(r.length)return t===r[1]}));if(!n)return t.showToast({title:"只允许上传".concat(r.imgType,"的类型"),icon:"none"}),{v:!1}}};for(o.s();!(i=o.n()).done;){var u=s();if("object"===typeof u)return u.v}}catch(c){o.e(c)}finally{o.f()}}r.currIndex=r.imgArray.length,r.imgArray=[].concat(e(r.imgArray),e(n.tempFilePaths)),r.changeImgArr(!1),r.pressImg>=0?r.checkPlatform()&&r.pressImages():r.hasAysnc()}}}):1==n.tapIndex&&t.chooseImage({count:Number(r.canUpCount),sizeType:["original","compressed"],sourceType:["album"],success:function(n){if(n){if(n.tempFiles){var i,o=a(n.tempFiles);try{var s=function(){var e=i.value;if(e.size>1024*r.imgSize*1024)return t.showToast({title:"图片不能大于".concat(r.imgSize,"M"),icon:"none"}),{v:!1};if(e.type){var n=r.imgType.some((function(t){var r=e.type.split("/");if(r.length)return t===r[1]}));if(!n)return t.showToast({title:"只允许上传".concat(r.imgType,"的类型"),icon:"none"}),{v:!1}}};for(o.s();!(i=o.n()).done;){var u=s();if("object"===typeof u)return u.v}}catch(c){o.e(c)}finally{o.f()}}r.currIndex=r.imgArray.length,r.imgArray=[].concat(e(r.imgArray),e(n.tempFilePaths)),r.changeImgArr(!1),r.pressImg>=0?r.checkPlatform()&&r.pressImages():r.hasAysnc()}}})},fail:function(t){console.log(t.errMsg)}})},preview:function(r,e){if(this.previewMany){var n=[];n.push(r.url),this.imgArray.map((function(t){r.id!=t.id&&n.push(t.url)})),t.previewImage({urls:n})}else t.previewImage({urls:[r.url]})},changeImgArr:function(t){for(var r in this.imgArray){var e=this.imgArray[r];e.upload||(!1===e.upload?this.imgArray[r].url=e.url:this.imgArray[r]={id:r,upload:t,url:e,result:t})}},pressImages:function(){var r,e=this,n=0,i=0,o=a(e.imgArray);try{var s=function(){var o=r.value;t.compressImage({src:o.url,quality:e.pressImg,success:function(t){++n,o.pressUrl=t.tempFilePath},error:function(t){console.log(t)},complete:function(t){if(++i,i===e.imgArray.length){if(console.log(n),n>=e.imgArray.length)e.tipObj.prompt="全部压缩成功！",e.tipObj.typeColor=e.tipObj.success;else{var r=e.imgArray.length-n;e.tipObj.prompt="".concat(r,"个文件压缩失败"),e.tipObj.typeColor=e.tipObj.warning}console.log("res",e.imgArray),e.async&&e.asyncUpload()}}})};for(o.s();!(r=o.n()).done;)s()}catch(u){o.e(u)}finally{o.f()}},asyncUpload:function(){var r=this;if(r.imgArray.length){r.startUpload=!0,r.tipObj.prompt="";for(var e=function(e){var n=r.imgArray[e],i=r.pressImg>=0?n.pressUrl:n.url;t.uploadFile({url:r.url,filePath:i,name:"file",header:r.headers,formData:r.formData,success:function(t){if(200==t.statusCode){var n=JSON.parse(t.data);0===n.code||"0"===n.code?(r.imgArray[e].result=!0,n.code=0):(r.imgArray[e].result=!1,r.tipObj.prompt="上传失败，请检查！",r.tipObj.typeColor=r.tipObj.error),r.$emit("result",n)}else r.imgArray[e].result=!1,r.$emit("result",t)},fail:function(t){r.imgArray[e].result=!1,r.tipObj.prompt="上传失败，请检查！",r.tipObj.typeColor=r.tipObj.error,console.log(t)},complete:function(){r.imgArray[e].upload=!0,r.startUpload=!1,console.log("list",r.imgArray),r.$forceUpdate()}})},n=r.currIndex;n<r.imgArray.length;n++)e(n)}},delImg:function(r){var e=this;t.showModal({title:"提示",content:"是否删除这张照片？",success:function(t){t.confirm?(e.imgArray.splice(r,1),e.async&&e.$emit("delImg",r)):t.cancel}})},upload:function(t){var r=this,e=this;e.async?(e.tipObj.prompt="在异步模式下无法调用upload方法。",e.tipObj.typeColor=e.tipObj.warning):(e.tipObj.prompt="",e.imgArray.length?function(){r.startUpload=!0;var n,i=0,o=[],s=a(e.imgArray);try{var u=function(){var r=n.value;e.uploadImg(r,(function(n){0==n.code?(i++,o.push(n.url),r.result=!0):(o.push(n),r.result=!1),r.upload=!0,e.$forceUpdate(),e.tipObj.prompt="正在上传...(成功"+i+"张/"+o.length+"张)",e.tipObj.typeColor=e.tipObj.success,o.length==e.imgArray.length&&(e.tipObj.prompt="已全部上传完成！",e.tipObj.typeColor=e.tipObj.success,i>0?(e.startUpload=!1,t(e.result(o,i))):(e.startUpload=!1,t(o)))}))};for(s.s();!(n=s.n()).done;)u()}catch(c){s.e(c)}finally{s.f()}}():(e.tipObj.prompt="请先选择图片后上传！",e.tipObj.typeColor=e.tipObj.warning))},result:function(t,r){var e={result:"success",code:0,urlArray:t,success:r};return e},uploadImg:function(r,e){var n=this,i=n.pressImg>=0?r.pressUrl:r.url;t.uploadFile({url:n.url,filePath:i,formData:n.formData,header:n.headers,name:"file",success:function(t){if(t){var r=JSON.parse(t.data);r.resCode=0,e(r)}},fail:function(t){e({resCode:500,msg:"图片上传失败",localUrl:r,reason:t})}})},changeHeader:function(t){var r=this;if(Array.isArray(t)){var e,n=a(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;for(var o in i)r.headers[o]=i[o]}}catch(s){n.e(s)}finally{n.f()}}else r.tipObj.prompt="请使用数组格式的Header传参",r.tipObj.typeColor=r.tipObj.error},hasAysnc:function(){var t=this;if(t.async){var r=t.imgArray.length;t.asyncUpload(r)}else t.$emit("result",{code:500,msg:"同步模式下,我不会被调用哦~"})},checkPlatform:function(){var t=!0;return t},getSysInfo:function(){var r=this;try{var e=t.getSystemInfoSync();r.sysInfo={screenWidth:e.screenWidth,screenHeight:e.screenHeight}}catch(n){}}}};r.default=c}).call(this,e("543d")["default"])},"8a75":function(t,r,e){"use strict";var n=e("6c20"),i=e.n(n);i.a},d153:function(t,r,e){"use strict";e.r(r);var n=e("112f"),i=e("fb55");for(var o in i)"default"!==o&&function(t){e.d(r,t,(function(){return i[t]}))}(o);e("8a75");var a,s=e("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"54308554",null,!1,n["a"],a);r["default"]=u.exports},fb55:function(t,r,e){"use strict";e.r(r);var n=e("7b65"),i=e.n(n);for(var o in n)"default"!==o&&function(t){e.d(r,t,(function(){return n[t]}))}(o);r["default"]=i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/poiuy-uImgUpload/imgUpload-create-component',
    {
        'components/poiuy-uImgUpload/imgUpload-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("d153"))
        })
    },
    [['components/poiuy-uImgUpload/imgUpload-create-component']]
]);
